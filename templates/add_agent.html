{% extends 'base.html' %}

{% block content %}
<div class="container mt-5" style="max-width: 700px;">
  <div class="card shadow-lg border-0">
    <div class="card-header text-white text-center" style="background-color: #7F6A93;">
      <h4 class="mb-0">Add New Agent + Stages</h4>
    </div>
    <div class="card-body" style="background-color: #E8EEF2;">
      <form method="POST" action="{{ url_for('add_agent') }}">
        <!-- Agent section -->
        <div class="mb-3">
          <label class="form-label fw-bold">Agent Name</label>
          <input type="text" class="form-control" name="agent_name" placeholder="e.g. Sylvia" required>
        </div>

        <div class="mb-4">
          <label class="form-label fw-bold">Agent Description</label>
          <textarea class="form-control" name="agent_description" rows="3" placeholder="Describe this agent..." required></textarea>
        </div>

        <hr>

        <!-- Stage section -->
        <h5 class="text-center fw-bold mb-3">Agent Stages</h5>

        <div id="stages-section">
          <!-- Default 3 stages -->
          {% for i, stage_type in [('Input', 'Upload CV files'), ('Summarise', 'Summarise CV content using AI'), ('Output', 'Display or export the summary results')] %}
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Stage Name</label>
              <input type="text" class="form-control" name="stage_name[]" value="{{ stage_type[0] }}" required>
            </div>
            <div class="col-md-8">
              <label class="form-label">Description</label>
              <input type="text" class="form-control" name="stage_desc[]" value="{{ stage_type[1] }}" required>
            </div>
          </div>
          {% endfor %}
        </div>

        <div class="text-end mb-3">
          <button type="button" class="btn btn-outline-dark btn-sm" onclick="addStage()">+ Add Another Stage</button>
        </div>

        <div class="d-flex justify-content-between">
          <a href="{{ url_for('get_all_agents_and_stages') }}" class="btn btn-outline-secondary">Back</a>
          <button type="submit" class="btn text-white" style="background-color: #7F6A93;">Save Agent</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function addStage() {
  const container = document.getElementById("stages-section");
  const div = document.createElement("div");
  div.className = "row mb-3";
  div.innerHTML = `
    <div class="col-md-4">
      <label class="form-label">Stage Name</label>
      <input type="text" class="form-control" name="stage_name[]" placeholder="Stage name" required>
    </div>
    <div class="col-md-8">
      <label class="form-label">Description</label>
      <input type="text" class="form-control" name="stage_desc[]" placeholder="Stage description" required>
    </div>
  `;
  container.appendChild(div);
}
</script>
{% endblock %}
