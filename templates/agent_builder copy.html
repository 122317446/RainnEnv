{% extends "base.html" %}
{% block content %}

<!-- ======================================================
 Agent Builder Form (Early build)
 Allows user to name an agent, select a model, choose an
 operation, and preview its stages before saving.
====================================================== -->

<div class="container mt-4">
    
    <h2>Build Your Agent</h2>

    <!-- Form submits to the same route using POST -->
    <form method="POST">

        <!-- ===============================
             Agent Name Input
        =============================== -->
        <div class="mb-3">
            <label class="form-label fw-bold">Agent Name</label>
            <input type="text" class="form-control" name="agent_name" required>
        </div>

        <!-- ===============================
             Agent Primer Input
        =============================== -->
        <div class="mb-3">
            <label class="form-label fw-bold">Prime the Agent / Describe the Agent</label>
            <input type="text" class="form-control" name="agent_priming" required>
        </div>

        <!-- ===============================
             AI Model Selection Dropdown
        =============================== -->
        <div class="mb-3">
            <label class="form-label fw-bold">Select AI Model</label>
            <select name="ai_model" class="form-select" required>
                <option value="">-- Choose Model --</option>
                <option value="gemma3:4b">gemma3:4b</option>
                <option value="llama3.1:8b">llama3.1:8b</option>
            </select>
        </div>

        <!-- ===============================
             Operation / Template Selection
             Uses Jinja loop to display all taskdefs.
             selected_taskdef preserves user choice.
        =============================== -->
        <div class="mb-3">
            <label class="form-label fw-bold">Select Operation</label>
            <select name="operation_selected" class="form-select" required>
                <option value="">-- Choose Task --</option>
                {% for t in taskdefs %}
                    <option value="{{ t.TaskDef_ID }}"
                        {% if selected_taskdef == t.TaskDef_ID %} selected {% endif %}>
                        {{ t.TaskDef_Name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- ===============================
             Stages Preview (only displays
             after selecting an operation).
             Rendered dynamically using Jinja.
        =============================== -->
        {% if stages %}
        <div class="mt-3">
            <h5>Stages for this Operation:</h5>
            <ul>
                {% for s in stages %}
                    <li><strong>{{ s.TaskStageDef_Type }}</strong> â€“ {{ s.TaskStageDef_Description }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- ===============================
             Submit Button
        =============================== -->
        <button type="submit" name="save_agent" class="btn btn-success">
            Save Agent Process
        </button>

        <!-- ===============================
             Success Message
             Displayed only when an agent
             is successfully created.
        =============================== -->
        {% if agent_saved %}
            <div class="alert alert-success mt-3">
                Agent Process created successfully!  
                <strong>Process ID:</strong> {{ saved_process_id }}
            </div>
        {% endif %}

    </form>

</div>

{% endblock %}
