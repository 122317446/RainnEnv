{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <h2>Agent Pipeline: {{ pipeline.Agent_Name }}</h2>
    <p class="text-muted">
        Operation: <strong>{{ taskdef.TaskDef_Name }}</strong>
    </p>

    <hr>

    <h4>Pipeline Workflow</h4>

    <ol class="list-group list-group-numbered mt-3">

        {% for s in stages %}
        <li class="list-group-item">

            <h5>{{ s.TaskStageDef_Type | capitalize }}</h5>
            <p class="text-muted">{{ s.TaskStageDef_Description }}</p>

            {% if loop.index == 1 %}
                <!-- Stage 1: Let user input file path -->
                <form method="POST" enctype="multipart/form-data" class="mt-2">

                    <label class="form-label fw-bold">Demo: Select a File</label>

                    <input type="file"
                        name="uploaded_file"
                        class="form-control"
                        accept=".txt,.pdf,.csv"
                        required>

                    <button type="submit" class="btn btn-primary btn-sm mt-2">
                        Upload & Continue
                    </button>

                </form>


                {% if file_text %}
                <div class="alert alert-success mt-2">
                    <strong>File Loaded!</strong><br>
                    {{ file_text }}
                </div>
                {% endif %}
            
            {% else %}
                <!-- Other stages: Placeholder -->
                <div class="alert alert-warning mt-2">
                    [AGENT IS RESPONSIBLE FOR THIS STAGE]
                </div>
            {% endif %}

        </li>
        {% endfor %}

    </ol>

</div>

{% endblock %}
