{% extends 'base.html' %}

{% block content %}

<p><u>Current agents in the database</u></p>
<ol>
    {% for agent in agents %}
    <li class="p-1">
        {{ agent.TaskDef_Name }}
        <!-- Button to open modal -->
        <button type="button" 
                class="btn btn-sm btn-secondary ms-2" 
                data-bs-toggle="modal" 
                data-bs-target="#agentModal{{ agent.TaskDef_ID }}">
            View Stages
        </button>

        <!-- Modal -->
        <div class="modal fade" id="agentModal{{ agent.TaskDef_ID }}" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content bg-light text-dark">
              <div class="modal-header">
                <h5 class="modal-title">{{ agent.TaskDef_Name }}'s Stages</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <ol>
                  {% for stage in stages_by_agent[agent.TaskDef_ID] %}
                    <li><b>{{ stage.TaskStageDef_Name }}</b> {{ stage.TaskStageDef_Description }}</li>
                  {% else %}
                    <li><i>No stages found for this agent.</i></li>
                  {% endfor %}
                </ol>
              </div>
            </div>
          </div>
        </div>
        <form method="POST" action="{{ url_for('delete_agent', agent_id=agent.TaskDef_ID) }}" 
              onsubmit="return confirm('Are you sure you want to delete this agent and its stages?');" 
              style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm">
            <i class="bi bi-trash"></i> Delete
          </button>
        </form>
    </li>
    {% endfor %}
</ol>

{% endblock %}
