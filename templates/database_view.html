{% extends "base.html" %}

{% block title %}Rainn | Database View{% endblock %}

{% block content %}

<div class="page-header d-print-none">
  <div class="row g-2 align-items-center">
    <div class="col">
      <div class="page-pretitle">Demo Tools</div>
      <h2 class="page-title">Database View</h2>
      <div class="text-secondary">Debug view of TaskDefs, TaskStages, and Agent Processes stored in SQLite.</div>
    </div>
  </div>
</div>

<div class="row row-cards">

  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Task Definitions (Operations)</h3>
      </div>
      <div class="table-responsive">
        <table class="table card-table table-vcenter">
          <thead>
            <tr>
              <th class="w-1">ID</th>
              <th>Operation Name</th>
              <th class="text-secondary">Description</th>
            </tr>
          </thead>
          <tbody>
            {% for t in taskdefs %}
            <tr>
              <td class="text-secondary">{{ t.TaskDef_ID }}</td>
              <td class="fw-semibold">{{ t.TaskDef_Name }}</td>
              <td class="text-secondary">{{ t.TaskDef_Description }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Task Stage Definitions (Workflow Steps)</h3>
      </div>
      <div class="table-responsive">
        <table class="table card-table table-vcenter">
          <thead>
            <tr>
              <th class="w-1">ID</th>
              <th class="text-secondary">TaskDef FK</th>
              <th>Stage Type</th>
              <th class="text-secondary">Stage Description</th>
            </tr>
          </thead>
          <tbody>
            {% for s in taskstages %}
            <tr>
              <td class="text-secondary">{{ s.TaskStageDef_ID }}</td>
              <td class="text-secondary">{{ s.TaskDef_ID_FK }}</td>
              <td class="fw-semibold">{{ s.TaskStageDef_Type }}</td>
              <td class="text-secondary">{{ s.TaskStageDef_Description }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Agent Processes</h3>
      </div>
      <div class="table-responsive">
        <table class="table card-table table-vcenter text-nowrap">
          <thead>
            <tr>
              <th class="w-1">ID</th>
              <th>Agent Name</th>
              <th class="text-secondary">Model</th>
              <th class="text-secondary">Task</th>
              <th class="text-secondary">Created</th>
              <th class="w-1"></th>
            </tr>
          </thead>
          <tbody>
            {% for p in processes %}
            <tr>
              <td class="text-secondary">{{ p.Process_ID }}</td>
              <td>
                <div class="fw-semibold">{{ p.Agent_Name }}</div>
                <div class="text-secondary text-truncate" style="max-width: 520px;">{{ p.Agent_Priming }}</div>
              </td>
              <td>{{ p.AI_Model }}</td>
              <td>{{ p.Operation_Selected }}</td>
              <td class="text-secondary">{{ p.Created_At }}</td>
              <td>
                <a href="{{ url_for('agent_runner_page', process_id=p.Process_ID) }}" class="btn btn-primary btn-sm">Run</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

{% endblock %}
