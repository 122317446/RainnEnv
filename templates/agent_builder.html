{% extends "base.html" %}

{% block title %}Rainn | Builder{% endblock %}

{% block content %}

<div class="page-header d-print-none">
  <div class="row g-2 align-items-center">
    <div class="col">
      <div class="page-pretitle">Builder</div>
      <h2 class="page-title">Create an agent process</h2>
      <div class="text-secondary">Iteration 4 preview – current form is retained for Iteration 3 demos.</div>
    </div>
  </div>
</div>

<div class="row row-cards">
  <div class="col-12 col-lg-8">
    <div class="card">
      <div class="card-body">
        <form method="POST" class="row g-3">

          <div class="col-12">
            <label class="form-label">Agent name</label>
            <input type="text" class="form-control" name="agent_name" required>
          </div>

          <div class="col-12">
            <label class="form-label">Agent primer</label>
            <textarea class="form-control" name="agent_priming" rows="3" required></textarea>
            <div class="form-hint">Describe the agent role, tone, constraints, and what “good output” looks like.</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">AI model (Ollama)</label>
            <select name="ai_model" class="form-select" required>
              <option value="">-- Choose Model --</option>
              <option value="gemma3:4b">gemma3:4b</option>
              <option value="llama3.1:8b">llama3.1:8b</option>
            </select>
            <div class="form-hint">Use the exact Ollama model id.</div>
          </div>

          <div class="col-12 col-md-6">
            <label class="form-label">Operation / template</label>
            <select name="operation_selected" class="form-select" required>
              <option value="">-- Choose Task --</option>
              {% for t in taskdefs %}
                <option value="{{ t.TaskDef_ID }}" {% if selected_taskdef == t.TaskDef_ID %} selected {% endif %}>
                  {{ t.TaskDef_Name }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div class="col-12">
            <button type="submit" name="save_agent" class="btn btn-primary">
              <i class="ti ti-device-floppy me-2"></i>Save agent process
            </button>
          </div>

          {% if agent_saved %}
            <div class="col-12">
              <div class="alert alert-success mb-0">
                Agent process created successfully. <strong>Process ID:</strong> {{ saved_process_id }}
              </div>
            </div>
          {% endif %}

        </form>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Stages preview</h3>
      </div>
      <div class="card-body">
        {% if stages %}
          <ol class="mb-0">
            {% for s in stages %}
              <li class="mb-2">
                <div class="fw-semibold">{{ s.TaskStageDef_Type }}</div>
                <div class="text-secondary">{{ s.TaskStageDef_Description }}</div>
              </li>
            {% endfor %}
          </ol>
        {% else %}
          <div class="text-secondary">Select an operation to preview its stages.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
